%description:
Test methods in DNSTools

%includes:
#include "DNS.h"
#include "DNSTools.h"

%global:

%activity:

// create a number of fragmented datagrams
DNSPacket *q = new DNSPacket("test_packet_1");

if(!ODnsExtension::isDNSpacket(q)){
    return;
}

// Set id and options in header ..
q->setId(12345);
q->setQdcount(1);
q->setAncount(1);
q->setNscount(1);
q->setArcount(1);

unsigned short options = 0;
// QR and OPCODE already 0..
// Recursion desired ..
DNS_HEADER_SET_RD(options, 0);

// Setup question
q->setNumQuestions(1);

ODnsExtension::DNSQuestion question;
question.qname = "unassigned.buffalo.net";
question.qclass = 0;
question.qtype = 0;
q->setQuestions(0, question);


// Now check if resolveQuery works:

ODnsExtension::Query* resolveQuery = ODnsExtension::resolveQuery(q);

// output some data
ev << "query id: " << resolveQuery->id << "\n";

%contains: stdout
query id: 12345